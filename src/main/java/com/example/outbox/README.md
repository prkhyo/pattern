# 아웃박스 패턴 (Outbox Pattern)

---

#### ref: https://techblog.woowahan.com/7835/ , https://microservices.io/patterns/data/transactional-outbox.html

### Outbox Pattern 이란?
<blockquote>
Outbox는 주로 웹 메일에서 ‘보낸 편지함’을 의미합니다. application 에서는 로컬 트랜잭션(동일 저장소를 사용한 트랜잭션)을 사용하여 데이터베이스를 저장하고 이벤트를 발행함에 정합성을 보장하기 위한 패턴
</blockquote>

### ➤ 언제 사용 하나요?
주로 Event Driven Architecture 를 따르는 서비스에서 Message Broker 들을 사용하여 이벤트를 발행하고 연관된 작업을 비동기로 실행합니다.<p></p>
이중 쓰기 문제: 일반적으로 데이터베이스와 메시지 브로커에 별도로 쓰기가 이루어질 때, 트랜잭션 실패나 네트워크 문제로 인해 하나는 성공하고 다른 하나는 실패할 수 있습니다. 이로 인해 시스템 상태가 불일치하게 됩니다.

따라서 서버 통신간 불확실한 통신을 보장하고 싶을때, 분산 Transaction 원자성을 보장 하고싶을때 사용합니다.
<br></br>

### Flow 는 다음과 같아요
- 데이터베이스에 변경을 가할 때, 동시에 "아웃박스 테이블"이라는 특별한 테이블에 전송해야 할 메시지도 함께 기록합니다.
- 메시지 큐 또는 브로커가 아웃박스 테이블을 모니터링하여 기록된 메시지를 전송한 후, 메시지가 성공적으로 전송되었음을 테이블에서 삭제하거나 업데이트합니다.

![outbox.png](..%2F..%2F..%2F..%2F..%2F..%2Fdocs%2Foutbox.png)

### Outbox 패턴의 이점
<blockquote>
- 데이터 일관성 보장: 데이터베이스의 상태와 외부 시스템(메시지 큐)의 상태가 항상 일치하게 됩니다.<br>
- 확장성: 대규모 마이크로서비스 아키텍처에서 특히 유용합니다.<br>
- 재처리 가능: 메시지 전송이 실패하더라도 데이터베이스에 기록된 메시지를 통해 재시도할 수 있습니다.<br>
</blockquote>

### Outbox 패턴의 단점
<blockquote>
복잡성 증가: 아웃박스 테이블을 모니터링하고 관리하는 로직을 추가로 구현해야 합니다.<br>
메시지 지연: 메시지가 처리되기까지 시간이 걸릴 수 있으며, 이는 실시간 처리가 필요한 경우에는 제약이 될 수 있습니다.<br>
</blockquote>
